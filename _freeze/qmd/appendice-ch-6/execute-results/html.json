{
  "hash": "826e531435a674cd8cd7254d2684d57d",
  "result": {
    "markdown": "---\noutput: html_document\neditor_options: \n  chunk_output_type: inline\n---\n\n# Appendice: Chapter 6 supplemental material\n\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-important}\nYou are reading the work-in-progress of this thesis. This chapter is currently a dumping ground for ideas, and I don't recommend reading it.\n:::\n\n\n## Some references\n\nSee @allen_1997; @bussab_1988; @degroot_2012; @hair_2019; @johnson_2013; @kuhn_2022; @dudek_2020; @dalpiaz_; @fox_2016.\n\nOther references:\n\n* <https://olsrr.rsquaredacademy.com>\n* <https://www.r-bloggers.com/2021/05/how-to-compare-nested-models-in-r/>\n* <https://www.r-bloggers.com/2022/10/box-cox-transformation-in-r/>\n* <https://online.stat.psu.edu/stat501/>\n\n## Statement\n\n$$\n\\begin{cases}\n\\text{H}_{0}: \\text{R}^{2}_{\\text{res}} >= \\text{R}^{2}_{\\text{full}} \\\\\n\\text{H}_{a}: \\text{R}^{2}_{\\text{res}} < \\text{R}^{2}_{\\text{full}}\n\\end{cases}\n$$\n\nGeneral equation for the F-test [@allen_1997, pp. 113]:\n\n$$\nF = \\cfrac{\\text{R}^{2}_{F} - \\text{R}^{2}_{R} / (k_{F} - k_{R})}{(1 - \\text{R}^{2}_{F}) / (\\text{N} - k_{F} - 1)}\n$$\n\nWhere:\n\n* $\\text{R}^{2}_{F}$ = Coefficient of determination for the __full__ model\n* $\\text{R}^{2}_{R}$ = Coefficient of determination for the __restricted__ model\n* $k_{F}$ = Number of independent variables in the full model\n* $k_{R}$ = Number of independent variables in the restricted model\n* $N$ = Number of observations in the sample\n\n$$\nF = \\cfrac{\\text{Additional Var. Explained} / \\text{Additional d.f. Expended}}{\\text{Var. unexplained} / \\text{d.f. Remaining}}\n$$\n\n## Assumptions\n\nSee [@degroot_2012, pp. 736-738] to learn more.\n\n::: {.callout-warning}\n__The predictor is known__. Either the vectors $z_{1}, \\dots , z_{n}$ are known ahead of time, or they are the observed values of random vectors $Z_{1}, \\dots , Z_{n}$ on whose values we condition before computing the joint distribution of ($Y_{1}, \\dots , Y_{n}$).\n:::\n\n::: {.callout-warning}\n__Normality__. For $i = 1, \\dots, n$, the conditional distribution of $Y_{i}$ given the vectors $z_{1}, \\dots , z_{n}$ is a normal distribution (__normality assumption__).\n:::\n\n::: {.callout-warning}\n__Linear mean__. There is a vector of parameters  $\\beta = (\\beta_{0}, \\dots, \\beta_{p - 1})$ such that the conditional mean of $Y_{i}$ given the values $z_{1}, \\dots , z_{n}$ has the form\n\n$$\nz_{i0} \\beta_{0} + z_{i1} \\beta_{1} + \\cdots + z_{ip - 1} \\beta_{p - 1}\n$$\n\nfor $i = 1, \\dots, n$ (__zero error mean assumption__).\n:::\n\n::: {.callout-warning}\n__Common variance__. The observations $Y_{1}, \\dots , Y_{n}$ have the same variance $\\sigma^{2}$ (__homoscedasticity assumption__).\n:::\n\n::: {.callout-warning}\n__Independence__. The random variables $Y_{1}, \\dots , Y_{n}$ are independent given the observed $z_{1}, \\dots , z_{n}$ (__independent errors assumption__).\n:::\n\n## Data preparation\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(dplyr)\nlibrary(here)\nlibrary(targets)\nlibrary(tidyr)\n\nsource(here::here(\"R/utils.R\"))\n\ndata <- \n  targets::tar_read(\"geocoded_data\", store = here::here(\"_targets\")) |>\n  dplyr::select(msf_sc, age, sex, state, latitude, longitude) |>\n  dplyr::mutate(msf_sc = transform_time(msf_sc)) |>\n  tidyr::drop_na(msf_sc, age, sex, latitude)\n```\n:::\n\n\n## Restricted model\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(MASS)\n\nbox_cox <- MASS::boxcox(msf_sc ~ age + sex, data = data)\nlambda <- box_cox$x[which.max(box_cox$y)]\n\nlambda\n#> [1] -1.1111\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-4-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(stats)\n\nres_model <- stats::lm(\n  ((msf_sc^lambda - 1) / lambda) ~ age + sex, data = data\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(broom)\n\n# ?broom::tidy.lm\nbroom::tidy(res_model)\n#> # A tibble: 3 × 5\n#>   term        estimate std.error   statistic  p.value\n#>   <chr>          <dbl>     <dbl>       <dbl>    <dbl>\n#> 1 (Intercept)  9.00e-1  1.75e- 9 513579298.  0       \n#> 2 age         -3.38e-9  5.19e-11       -65.1 0       \n#> 3 sexMale      1.32e-8  1.02e- 9        13.0 1.03e-38\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(broom)\nlibrary(dplyr)\nlibrary(tidyr)\n\n# ?broom::glance.lm\nbroom::glance(res_model) |> tidyr::pivot_longer(cols = dplyr::everything())\n#> # A tibble: 12 × 2\n#>   name            value\n#>   <chr>           <dbl>\n#> 1 r.squared     5.37e-2\n#> 2 adj.r.squared 5.37e-2\n#> 3 sigma         1.33e-7\n#> 4 statistic     2.18e+3\n#> 5 p.value       0      \n#> 6 df            2   e+0\n#> # ℹ 6 more rows\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(olsrr)\n\n# res_model |> olsrr::ols_regress()\nres_model |> summary()\n#> \n#> Call:\n#> stats::lm(formula = ((msf_sc^lambda - 1)/lambda) ~ age + sex, \n#>     data = data)\n#> \n#> Residuals:\n#>           Min            1Q        Median            3Q           Max \n#> -0.0000004859 -0.0000000911 -0.0000000031  0.0000000916  0.0000004204 \n#> \n#> Coefficients:\n#>                     Estimate       Std. Error     t value Pr(>|t|)    \n#> (Intercept)  0.8999976603602  0.0000000017524 513579298.2   <2e-16 ***\n#> age         -0.0000000033812  0.0000000000519       -65.1   <2e-16 ***\n#> sexMale      0.0000000132309  0.0000000010162        13.0   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.000000133 on 76741 degrees of freedom\n#> Multiple R-squared:  0.0537,\tAdjusted R-squared:  0.0537 \n#> F-statistic: 2.18e+03 on 2 and 76741 DF,  p-value: <2e-16\n```\n:::\n\n\n### Residual diagnostics\n\n> Normality and zero mean error assumption.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(here)\nlibrary(stats)\n\nsource(here::here(\"R/stats_sum.R\"))\n\nres_model |>\n  stats::residuals() |>\n  stats_sum()\n#> # A tibble: 14 × 2\n#>   name    value                         \n#>   <chr>   <chr>                         \n#> 1 n       76744                         \n#> 2 n_rm_na 76744                         \n#> 3 n_na    0                             \n#> 4 mean    6.60699976667332e-23          \n#> 5 var     0.0000000000000176852866826985\n#> 6 sd      0.000000132986039427823       \n#> # ℹ 8 more rows\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(fBasics)\nlibrary(moments)\n\nsource(here::here(\"R/normality_sum.R\"))\n\n# ?moments::agostino.test\n# ?fBasics::dagoTest()\n\nres_model |>\n  stats::residuals() |>\n  normality_sum()\n#> # A tibble: 11 × 2\n#>   test                       p_value\n#>   <chr>                        <dbl>\n#> 1 Anderson-Darling          3.7 e-24\n#> 2 Bonett-Seier              0       \n#> 3 Cramer-von Mises          7.37e-10\n#> 4 D'Agostino Omnibus Test  NA       \n#> 5 D'Agostino Skewness Test  2.34e- 1\n#> 6 D'Agostino Kurtosis Test NA       \n#> # ℹ 5 more rows\n```\n:::\n\n\nCorrelation between observed residuals and expected residuals under normality.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(olsrr)\n#| code-fold: false\n\nres_model |> olsrr::ols_test_correlation()\n#> [1] 0.99929\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\nlibrary(olsrr)\nlibrary(stats)\n\nsource(here::here(\"R/test_normality.R\"))\n\n# res_model |> olsrr::ols_plot_resid_qq()\n\nqq_plot <- res_model |> \n  stats::residuals() |>\n  plot_qq(print = FALSE)\n\nhist_plot <- res_model |>\n  stats::residuals() |>\n  plot_hist(print = FALSE)\n\ncowplot::plot_grid(hist_plot, qq_plot, ncol = 2, nrow = 1)\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-12-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(olsrr)\n\n# Linear mean assumption\n\nres_model |> olsrr::ols_plot_resid_fit()\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-13-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres_model |> plot(3)\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-14-1.png){width=576}\n:::\n:::\n\n\n### Heteroskedasticity\n\n> Homoscedasticity assumption.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(olsrr)\n\n# \"It test whether variance of errors from a regression is dependent on the values of a independent variable.\"\n\nres_model |> olsrr::ols_test_breusch_pagan()\n#> \n#>  Breusch Pagan Test for Heteroskedasticity\n#>  -----------------------------------------\n#>  Ho: the variance is constant            \n#>  Ha: the variance is not constant        \n#> \n#>                           Data                           \n#>  --------------------------------------------------------\n#>  Response : ((msf_sc^lambda - 1)/lambda) \n#>  Variables: fitted values of ((msf_sc^lambda - 1)/lambda) \n#> \n#>         Test Summary          \n#>  -----------------------------\n#>  DF            =    1 \n#>  Chi2          =    70149.3586 \n#>  Prob > Chi2   =    0.0000\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(olsrr)\n\nres_model |> olsrr::ols_test_score()\n#> \n#>  Score Test for Heteroskedasticity\n#>  ---------------------------------\n#>  Ho: Variance is homogenous\n#>  Ha: Variance is not homogenous\n#> \n#>  Variables: fitted values of ((msf_sc^lambda - 1)/lambda) \n#> \n#>       Test Summary       \n#>  ------------------------\n#>  DF            =    1 \n#>  Chi2          =    0.000 \n#>  Prob > Chi2   =    1.000\n```\n:::\n\n\n### Collinearity diagnostics\n\n> Independence assumption.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(olsrr)\n\nres_model |> olsrr::ols_coll_diag()\n#> Tolerance and Variance Inflation Factor\n#> ---------------------------------------\n#>   Variables Tolerance    VIF\n#> 1       age    0.9988 1.0012\n#> 2   sexMale    0.9988 1.0012\n#> \n#> \n#> Eigenvalue and Condition Index\n#> ------------------------------\n#>   Eigenvalue Condition Index intercept      age   sexMale\n#> 1   2.422418          1.0000  0.011753 0.011936 0.0669897\n#> 2   0.538450          2.1211  0.015824 0.018848 0.9280439\n#> 3   0.039132          7.8679  0.972423 0.969216 0.0049664\n```\n:::\n\n\n> The variance inflation factor measures how much the behavior (variance) of an independent variable is influenced, or inflated, by its interaction/correlation with the other independent variables (e.g., VIF equal to 1 = variables are not correlated).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(car)\n\nres_model |> car::vif()\n#>    age    sex \n#> 1.0012 1.0012\n```\n:::\n\n\n### Measures of influence\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(olsrr)\n\nres_model |> olsrr::ols_plot_resid_lev()\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-19-1.png){width=576}\n:::\n:::\n\n\n\n## Full model\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(MASS)\n\nbox_cox <- MASS::boxcox(\n  msf_sc ~ age + sex + latitude, data = data\n  )\n\nbox_cox$x[which.max(box_cox$y)] # lambda\n#> [1] -1.1515\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-20-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlambda # The same lambda of the restricted model\n#> [1] -1.1111\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(stats)\n\nfull_model <- stats::lm(\n  ((msf_sc^lambda - 1) / lambda) ~ age + sex + latitude, \n  data = data\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(broom)\n\n# ?broom::tidy.lm\nbroom::tidy(full_model)\n#> # A tibble: 4 × 5\n#>   term        estimate std.error   statistic   p.value\n#>   <chr>          <dbl>     <dbl>       <dbl>     <dbl>\n#> 1 (Intercept)  9.00e-1  2.30e- 9 391908053.  0        \n#> 2 age         -3.47e-9  5.19e-11       -66.9 0        \n#> 3 sexMale      1.37e-8  1.01e- 9        13.6 7.94e- 42\n#> 4 latitude    -1.82e-9  7.64e-11       -23.9 2.74e-125\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(broom)\nlibrary(dplyr)\nlibrary(tidyr)\n\n# ?broom::glance.lm\nbroom::glance(full_model) |>\n  tidyr::pivot_longer(cols = dplyr::everything())\n#> # A tibble: 12 × 2\n#>   name            value\n#>   <chr>           <dbl>\n#> 1 r.squared     6.07e-2\n#> 2 adj.r.squared 6.07e-2\n#> 3 sigma         1.32e-7\n#> 4 statistic     1.65e+3\n#> 5 p.value       0      \n#> 6 df            3   e+0\n#> # ℹ 6 more rows\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# full_model |> olsrr::ols_regress()\nfull_model |> summary()\n#> \n#> Call:\n#> stats::lm(formula = ((msf_sc^lambda - 1)/lambda) ~ age + sex + \n#>     latitude, data = data)\n#> \n#> Residuals:\n#>           Min            1Q        Median            3Q           Max \n#> -0.0000004874 -0.0000000911 -0.0000000034  0.0000000912  0.0000004328 \n#> \n#> Coefficients:\n#>                     Estimate       Std. Error     t value Pr(>|t|)    \n#> (Intercept)  0.8999976247783  0.0000000022965 391908052.9   <2e-16 ***\n#> age         -0.0000000034710  0.0000000000519       -66.9   <2e-16 ***\n#> sexMale      0.0000000137296  0.0000000010127        13.6   <2e-16 ***\n#> latitude    -0.0000000018222  0.0000000000764       -23.9   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.000000132 on 76740 degrees of freedom\n#> Multiple R-squared:  0.0607,\tAdjusted R-squared:  0.0607 \n#> F-statistic: 1.65e+03 on 3 and 76740 DF,  p-value: <2e-16\n```\n:::\n\n\n### Residual diagnostics\n\n> Normality and zero mean error assumption.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(here)\nlibrary(stats)\n\nsource(here::here(\"R/stats_sum.R\"))\n\nfull_model |>\n  stats::residuals() |>\n  stats_sum()\n#> # A tibble: 14 × 2\n#>   name    value                         \n#>   <chr>   <chr>                         \n#> 1 n       76744                         \n#> 2 n_rm_na 76744                         \n#> 3 n_na    0                             \n#> 4 mean    4.85272564733669e-24          \n#> 5 var     0.0000000000000175551361304561\n#> 6 sd      0.00000013249579665203        \n#> # ℹ 8 more rows\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(here)\nlibrary(stats)\n\nsource(here::here(\"R/normality_sum.R\"))\n\nfull_model |>\n  stats::residuals() |>\n  normality_sum()\n#> # A tibble: 11 × 2\n#>   test                       p_value\n#>   <chr>                        <dbl>\n#> 1 Anderson-Darling          3.7 e-24\n#> 2 Bonett-Seier              0       \n#> 3 Cramer-von Mises          7.37e-10\n#> 4 D'Agostino Omnibus Test  NA       \n#> 5 D'Agostino Skewness Test  9.41e- 1\n#> 6 D'Agostino Kurtosis Test NA       \n#> # ℹ 5 more rows\n```\n:::\n\n\nCorrelation between observed residuals and expected residuals under normality.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(olsrr)\n\nfull_model |> olsrr::ols_test_correlation()\n#> [1] 0.99929\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\nlibrary(cowplot)\nlibrary(olsrr)\nlibrary(stats)\n\nsource(here::here(\"R/test_normality.R\"))\n\n# full_model |> olsrr::ols_plot_resid_qq()\n\nhist_plot <- full_model |>\n  stats::residuals() |>\n  plot_hist(print = FALSE)\n\nqq_plot <- full_model |> \n  stats::residuals() |>\n  plot_qq(print = FALSE)\n\ncowplot::plot_grid(hist_plot, qq_plot, ncol = 2, nrow = 1)\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-29-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(olsrr)\n\nfull_model |> olsrr::ols_plot_resid_fit()\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-30-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_model |> plot(3)\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-31-1.png){width=576}\n:::\n:::\n\n\n### Heteroskedasticity\n\n> Homoscedasticity assumption.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(olsrr)\n\nfull_model |> olsrr::ols_test_breusch_pagan()\n#> \n#>  Breusch Pagan Test for Heteroskedasticity\n#>  -----------------------------------------\n#>  Ho: the variance is constant            \n#>  Ha: the variance is not constant        \n#> \n#>                           Data                           \n#>  --------------------------------------------------------\n#>  Response : ((msf_sc^lambda - 1)/lambda) \n#>  Variables: fitted values of ((msf_sc^lambda - 1)/lambda) \n#> \n#>         Test Summary          \n#>  -----------------------------\n#>  DF            =    1 \n#>  Chi2          =    70101.1634 \n#>  Prob > Chi2   =    0.0000\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(olsrr)\n\nfull_model |> olsrr::ols_test_score()\n#> \n#>  Score Test for Heteroskedasticity\n#>  ---------------------------------\n#>  Ho: Variance is homogenous\n#>  Ha: Variance is not homogenous\n#> \n#>  Variables: fitted values of ((msf_sc^lambda - 1)/lambda) \n#> \n#>       Test Summary       \n#>  ------------------------\n#>  DF            =    1 \n#>  Chi2          =    0.000 \n#>  Prob > Chi2   =    1.000\n```\n:::\n\n\n### Collinearity diagnostics\n\n> Independence assumption.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(olsrr)\n\nfull_model |> olsrr::ols_coll_diag()\n#> Tolerance and Variance Inflation Factor\n#> ---------------------------------------\n#>   Variables Tolerance    VIF\n#> 1       age   0.99354 1.0065\n#> 2   sexMale   0.99838 1.0016\n#> 3  latitude   0.99441 1.0056\n#> \n#> \n#> Eigenvalue and Condition Index\n#> ------------------------------\n#>   Eigenvalue Condition Index  intercept       age   sexMale  latitude\n#> 1   3.312504          1.0000 0.00377395 0.0064918 0.0304493 0.0068553\n#> 2   0.584652          2.3803 0.00328127 0.0064143 0.9588857 0.0083393\n#> 3   0.073700          6.7042 0.00040414 0.5063551 0.0023826 0.5659326\n#> 4   0.029145         10.6609 0.99254063 0.4807389 0.0082824 0.4188728\n```\n:::\n\n\n> The variance inflation factor measures how much the behavior (variance) of an independent variable is influenced, or inflated, by its interaction/correlation with the other independent variables (e.g., VIF equal to 1 = variables are not correlated).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(car)\n\nfull_model |> car::vif()\n#>      age      sex latitude \n#>   1.0065   1.0016   1.0056\n```\n:::\n\n\n### Measures of influence\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(olsrr)\n\nfull_model |> olsrr::ols_plot_resid_lev()\n```\n\n::: {.cell-output-display}\n![](appendice-ch-6_files/figure-html/unnamed-chunk-36-1.png){width=576}\n:::\n:::\n\n\n\n## Nested regression models test\n\n$$\n\\begin{cases}\n\\text{H}_{0}: \\text{R}^{2}_{\\text{res}} >= \\text{R}^{2}_{\\text{full}} \\\\\n\\text{H}_{a}: \\text{R}^{2}_{\\text{res}} < \\text{R}^{2}_{\\text{full}}\n\\end{cases}\n$$\n\n$$\nF = \\cfrac{\\text{R}^{2}_{F} - \\text{R}^{2}_{R} / (k_{F} - k_{R})}{(1 - \\text{R}^{2}_{F}) / (\\text{N} - k_{F} - 1)}\n$$\n\n$$\nF = \\cfrac{\\text{Additional Var. Explained} / \\text{Additional d.f. Expended}}{\\text{Var. unexplained} / \\text{d.f. Remaining}}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(dplyr)\nlibrary(here)\n\nsource(here::here(\"R/utils-stats.R\"))\n\ndplyr::tibble(\n  name = c(\"r_squared_res\", \"r_squared_full\", \"diff\"),\n  value = c(\n  r_squared(res_model), r_squared(full_model), \n  r_squared(full_model) - r_squared(res_model)\n  )\n)\n#> # A tibble: 3 × 2\n#>   name             value\n#>   <chr>            <dbl>\n#> 1 r_squared_res  0.0537 \n#> 2 r_squared_full 0.0607 \n#> 3 diff           0.00696\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(stats)\n\nstats::anova(res_model, full_model)\n#> Analysis of Variance Table\n#> \n#> Model 1: ((msf_sc^lambda - 1)/lambda) ~ age + sex\n#> Model 2: ((msf_sc^lambda - 1)/lambda) ~ age + sex + latitude\n#>   Res.Df           RSS Df        Sum of Sq   F Pr(>F)    \n#> 1  76741 0.00000000136                                   \n#> 2  76740 0.00000000135  1 0.00000000000999 569 <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(stats)\nlibrary(here)\n\nsource(here::here(\"R/utils-stats.R\"))\n\nn <- nrow(data)\nk_res <- length(stats::coefficients(res_model)) - 1\nk_full <- length(stats::coefficients(full_model)) - 1\n\n((r_squared(full_model) - r_squared(res_model)) / (k_full - k_res)) / ((1 - r_squared(full_model)) / (n  - k_full - 1))\n#> [1] 568.94\n```\n:::\n\n\n$$\nf^{2} = \\cfrac{\\text{R}^{2}_{F} - \\text{R}^{2}_{R}}{1 - \\text{R}^{2}_{F}}\n$$\n\n$$\nf^{2} = \\cfrac{\\text{Additional Var. Explained}}{\\text{Var. unexplained}}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(here)\n\nsource(here::here(\"R/cohens_f_squared.R\"))\nsource(here::here(\"R/utils-stats.R\"))\n\ncohens_f_squared_summary(\n  adj_r_squared(res_model), \n  adj_r_squared(full_model)\n  )\n#> # A tibble: 2 × 2\n#>   name        value              \n#>   <chr>       <chr>              \n#> 1 f_squared   0.00740068896515648\n#> 2 effect_size Negligible\n```\n:::\n\n\n## Group test\n\n$$\n\\begin{cases}\n\\text{H}_{0}: \\text{MSF}^{2^{o}}_{\\text{sc}} >= \\text{MSF}^{30^{o}}_{\\text{sc}} \\\\\n\\text{H}_{a}: \\text{MSF}^{2^{o}}_{\\text{sc}} < \\text{MSF}^{30^{o}}_{\\text{sc}}\n\\end{cases}\n$$\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(dplyr)\nlibrary(here)\nlibrary(magrittr)\n\nsource(here::here(\"R/stats_sum.R\"))\n\ngroup_1 <- \"Amapá\" # Boa vista (0° 2′ 18.84″ N, 51° 3′ 59.1″ W)\n\nmsf_sc_group_1 <- \n  data |>\n  dplyr::filter(state == group_1) |>\n  magrittr::extract2(\"msf_sc\")\n\nstats_sum_group_1 <- \n  data |> \n  dplyr::filter(state == group_1) |>\n  magrittr::extract2(\"msf_sc\") |> \n  stats_sum()\n#> # A tibble: 14 × 2\n#>   name    value           \n#>   <chr>   <chr>           \n#> 1 n       113             \n#> 2 n_rm_na 113             \n#> 3 n_na    0               \n#> 4 mean    103564.475347661\n#> 5 var     28720417.6933099\n#> 6 sd      5359.14337308771\n#> # ℹ 8 more rows\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(dplyr)\nlibrary(here)\nlibrary(magrittr)\n\nsource(here::here(\"R/stats_sum.R\"))\n\ngroup_2 <- \"Rio Grande do Sul\" # Porto Alegre (30° 01' 58\" S, 51° 13' 48\" O)\n\nmsf_sc_group_2 <- data |>\n  dplyr::filter(state == group_2) |>\n  magrittr::extract2(\"msf_sc\")\n\nstats_sum_group_2 <- \n  data |> \n  dplyr::filter(state == group_2) |>\n  magrittr::extract2(\"msf_sc\") |> \n  stats_sum()\n#> # A tibble: 14 × 2\n#>   name    value           \n#>   <chr>   <chr>           \n#> 1 n       4097            \n#> 2 n_rm_na 4097            \n#> 3 n_na    0               \n#> 4 mean    103651.485407441\n#> 5 var     26397872.5737977\n#> 6 sd      5137.88600241361\n#> # ℹ 8 more rows\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(stats)\n\nstats::t.test(msf_sc_group_1, msf_sc_group_2, alternative = \"less\")\n#> \n#> \tWelch Two Sample t-test\n#> \n#> data:  msf_sc_group_1 and msf_sc_group_2\n#> t = -0.17, df = 118, p-value = 0.43\n#> alternative hypothesis: true difference in means is less than 0\n#> 95 percent confidence interval:\n#>    -Inf 759.34\n#> sample estimates:\n#> mean of x mean of y \n#>    103564    103651\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(dplyr)\n\ndplyr::tibble(\n  name = c(\"mean_group_1\", \"mean_group_2\", \"diff\"),\n  value = c(\n  stats_sum_group_1$mean, stats_sum_group_2$mean, \n  stats_sum_group_2$mean - stats_sum_group_1$mean\n  )\n)\n#> # A tibble: 3 × 2\n#>   name            value\n#>   <chr>           <dbl>\n#> 1 mean_group_1 103564. \n#> 2 mean_group_2 103651. \n#> 3 diff             87.0\n```\n:::\n\n\n[@frey_2022, pp. 224-227]\n\n$$\nd = \\cfrac{\\mu_{1} - \\mu_{2}}{\\sigma_{e}}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(effsize)\n\neffsize::cohen.d(msf_sc_group_1, msf_sc_group_2)\n#> \n#> Cohen's d\n#> \n#> d estimate: -0.016915 (negligible)\n#> 95 percent confidence interval:\n#>    lower    upper \n#> -0.20387  0.17004\n```\n:::\n",
    "supporting": [
      "appendice-ch-6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}