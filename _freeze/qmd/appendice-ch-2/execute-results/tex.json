{
  "hash": "6e4f9af30c7dcac29f6c5dfdc8010e7b",
  "result": {
    "markdown": "# Appendice: Chapter 2 supplemental material\n\n\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-note}\nYou are reading the work-in-progress of this thesis. This chapter should be readable but is currently undergoing final polishing.\n:::\n\n\n\n## Load and embed texts\n\nSee @vartanian2017 to visualize the data questionnaire.\n\nSee @roenneberg2006 to visualize the EUCLOCK portuguese questionnaire.\n\nSee @reis2020 to learn more about the MCTQ^PT^ questionnaire.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndata_text <- c(\n  \"Você vai para a cama às ___ horas.\",\n  \"Algumas pessoas permanecem um tempo acordadas depois que vão se deitar.\",\n  \"Depois de ir para a cama, você decide dormir às ___ horas.\",\n  \"Você precisa de ___ para dormir.\",\n  \"Você acorda às ___ horas.\",\n  \"Você se levanta ___ depois de despertar.\",\n  \"Você vai para a cama às ___ horas.\",\n  \"\",\n  \"Depois de ir para a cama, você decide dormir às ___ horas.\",\n  \"Você precisa de ___ para dormir.\",\n  \"Você acorda às ___ horas.\",\n  \"Você se levanta ___ depois de despertar.\"\n)\n\neuclock_text <- c(\n  \"vou para a cama às ___ horas.\",\n  \"Algumas pessoas permanecem um tempo acordadas depois que vão se deitar.\",\n  \"às ___ horas, decido dormir.\",\n  \"Eu necessito ___ minutos para adormecer.\",\n  \"acordo às ___ horas,\",\n  \"passados ___ minutos, me levanto.\",\n  \"vou para a cama às ___ horas.\",\n  \"Algumas pessoas permanecem um tempo acordadas depois que vão se deitar.\",\n  \"às ___ horas, decido dormir.\",\n  \"Eu necessito ___ minutos para adormecer.\",\n  \"acordo às ___ horas,\",\n  \"passados ___ minutos, me acordo.\"\n)\n\nmctq_pt_text <- c(\n  \"Vou para a cama às ___ horas.\",\n  \"Algumas pessoas permanecem algum tempo acordadas depois de estarem na cama.\",\n  \"Às ___ horas estou pronto para adormecer.\",\n  \"Necessito de ___ minutos para adormecer.\",\n  \"Acordo às ___ horas.\",\n  \"Após ___ minutos, levanto-me.\",\n  \"Vou para a cama às ___ horas.\",\n  \"Algumas pessoas permanecem algum tempo acordadas depois de estarem na cama.\",\n  \"Às ___ horas estou pronto para adormecer.\",\n  \"Necessito de ___ minutos para adormecer.\",\n  \"Acordo às ___ horas.\",\n  \"Após ___ minutos, levanto-me.\"\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# library(textreuse)\n\ndata_text_textreuse <- \n  textreuse::TextReuseTextDocument(\n    text = data_text,\n    meta = list(id = \"data\")\n  )\n\neuclock_text_textreuse <- \n  textreuse::TextReuseTextDocument(\n    text = euclock_text,\n    meta = list(id = \"euclock\")\n  )\n\nmctq_pt_text_textreuse <- \n  textreuse::TextReuseTextDocument(\n    text = mctq_pt_text,\n    meta = list(id = \"mctq_pt\")\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# See\n# <https://huggingface.co/neuralmind/bert-base-portuguese-cased>\n# to learn more.\n\n# library(checkmate)\n# library(text)\n# library(rutils)\n\nrutils:::assert_internet()\n\ntext_embed <- function(text) {\n  checkmate::assert_character(text)\n  \n  text |>\n    text::textEmbed(\n      model = \"neuralmind/bert-base-portuguese-cased\",\n      layers = - 2,\n      dim_name = TRUE,\n      aggregation_from_layers_to_tokens = \"concatenate\",\n      aggregation_from_tokens_to_texts = \"mean\",\n      aggregation_from_tokens_to_word_types = NULL,\n      keep_token_embeddings = TRUE,\n      tokens_select = NULL,\n      tokens_deselect = NULL,\n      decontextualize = FALSE,\n      model_max_length = NULL,\n      max_token_to_sentence = 4,\n      tokenizer_parallelism = FALSE,\n      device = \"gpu\",\n      logging_level = \"error\"\n    )\n}\n\ndata_text_textembed <- text_embed(data_text)\neuclock_text_textembed <- text_embed(euclock_text)\nmctq_pt_text_textembed <- text_embed(mctq_pt_text)\n```\n:::\n\n\n\n## Text similarity\n\nSee @wang2020 to learn more.\n\nFor a quick explanation, see <https://youtu.be/e9U0QAFbfLI>.\n\n<!-- See also: https://github.com/microsoft/semantic-kernel/blob/main/docs/EMBEDDINGS.md -->\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# See `?text::textSimilarity` to learn more.\n\n# library(checkmate)\n# library(cli)\n# library(text)\n\ntext_distance <- function(x, y) {\n  checkmate::assert_list(x, len = 2)\n  checkmate::assert_list(y, len = 2)\n  \n  methods <- c(\n    \"binary\", \"cosine\", \"canberra\", \"euclidean\", \"manhattan\", \"maximum\", \n    \"minkowski\", \"pearson\"\n  )\n  \n  for (i in methods) {\n    cli::cli_alert_info(paste0(\n      \"Method: {.strong {stringr::str_to_title(i)}}\"\n      ))\n    \n    test <- \n      text::textSimilarity(\n        x$texts$texts, \n        y$texts$texts, \n        method = i, \n        center = TRUE, \n        scale = FALSE\n      )\n    \n    cli::cli_bullets(c(\">\" = \"Line by line\"))\n    print(test)\n    \n    cli::cli_bullets(c(\">\" = \"Overall mean\"))\n    print(mean(test))\n    \n    cli::cat_line()\n  }\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# See `?textreuse::jaccard_similarity` to learn more.\n\n# library(checkmate)\n# library(cli)\n# library(textreuse)\n\ntext_representation <- function(x, y) {\n  checkmate::assert_class(x, \"TextReuseTextDocument\")\n  checkmate::assert_class(y, \"TextReuseTextDocument\")\n  \n  cli::cli_alert_info(paste0(\"Method: {.strong Jaccard similarity}\"))\n  print(textreuse::jaccard_similarity(x, y))\n  cli::cat_line()\n  \n  cli::cli_alert_info(paste0(\"Method: {.strong Jaccard bag similarity}\"))\n  print(textreuse::jaccard_bag_similarity(x, y))\n  cli::cat_line()\n}\n```\n:::\n\n\n\n### How similar is the _data questionnaire_ when compared to the _EUCLOCK questionnaire_?\n\n#### Text distance | Embedded (Semantic) test\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# See `?text::textSimilarity` to learn more.\n\ntext_distance(data_text_textembed, euclock_text_textembed)\n#> i Method: Binary\n#> > Line by line\n#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1\n#> > Overall mean\n#> [1] 1\n#> i Method: Cosine\n#> > Line by line\n#>  [1] 0.9911730 1.0000000 0.9639984 0.9662432 0.9604119 0.9557896 0.9911730\n#>  [8] 0.1559853 0.9639984 0.9662432 0.9604119 0.9497428\n#> > Overall mean\n#> [1] 0.9020976\n#> i Method: Canberra\n#> > Line by line\n#>  [1] -218.3367    1.0000 -335.1895 -318.9419 -335.9000 -373.7989 -218.3367\n#>  [8] -642.5522 -335.1895 -318.9419 -335.9000 -381.4067\n#> > Overall mean\n#> [1] -317.7912\n#> i Method: Euclidean\n#> > Line by line\n#>  [1]  -1.504474   1.000000  -4.058168  -3.976768  -4.144779  -4.705653\n#>  [7]  -1.504474 -19.453535  -4.058168  -3.976768  -4.144779  -5.071087\n#> > Overall mean\n#> [1] -4.633221\n#> i Method: Manhattan\n#> > Line by line\n#>  [1]  -53.58509    1.00000 -108.96057 -105.53439 -111.46668 -124.16400\n#>  [7]  -53.58509 -198.94244 -108.96057 -105.53439 -111.46668 -131.16054\n#> > Overall mean\n#> [1] -101.03\n#> i Method: Maximum\n#> > Line by line\n#>  [1]   0.52944993   1.00000000   0.37664773   0.07405534   0.11978415\n#>  [6]   0.31058226   0.52944993 -14.91353795   0.37664773   0.07405534\n#> [11]   0.11978415   0.16830817\n#> > Overall mean\n#> [1] -0.9362311\n#> i Method: Minkowski\n#> > Line by line\n#>  [1]  -1.504474   1.000000  -4.058168  -3.976768  -4.144779  -4.705653\n#>  [7]  -1.504474 -19.453535  -4.058168  -3.976768  -4.144779  -5.071087\n#> > Overall mean\n#> [1] -4.633221\n#> i Method: Pearson\n#> > Line by line\n#>  [1] 0.9911730 1.0000000 0.9639984 0.9662432 0.9604119 0.9557896 0.9911730\n#>  [8] 0.1559853 0.9639984 0.9662432 0.9604119 0.9497428\n#> > Overall mean\n#> [1] 0.9020976\n```\n:::\n\n\n\n#### Text representation\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# The maximum value for the Jaccard bag similarity is 0.5.\n\ntext_representation(euclock_text_textreuse, data_text_textreuse)\n#> i Method: Jaccard similarity\n#> [1] 0.2173913\n#> i Method: Jaccard bag similarity\n#> [1] 0.1446541\n```\n:::\n\n\n\n### How similar is the _data questionnaire_ when compared to the _MCTQ^PT^ questionnaire_?\n\n#### Text distance | Embedded (Semantic) test\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# See `?text::textSimilarity` to learn more.\n\ntext_distance(data_text_textembed, mctq_pt_text_textembed)\n#> i Method: Binary\n#> > Line by line\n#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1\n#> > Overall mean\n#> [1] 1\n#> i Method: Cosine\n#> > Line by line\n#>  [1] 0.9901437 0.9898982 0.9687513 0.9575260 0.9882873 0.9598702 0.9901437\n#>  [8] 0.1601500 0.9687513 0.9575260 0.9882873 0.9598702\n#> > Overall mean\n#> [1] 0.9066005\n#> i Method: Canberra\n#> > Line by line\n#>  [1] -227.9938 -247.6044 -335.9297 -349.9493 -225.4809 -353.5263 -227.9938\n#>  [8] -631.6228 -335.9297 -349.9493 -225.4809 -353.5263\n#> > Overall mean\n#> [1] -322.0823\n#> i Method: Euclidean\n#> > Line by line\n#>  [1]  -1.662187  -1.729814  -3.807963  -4.603019  -1.810249  -4.458696\n#>  [7]  -1.662187 -19.380367  -3.807963  -4.603019  -1.810249  -4.458696\n#> > Overall mean\n#> [1] -4.482867\n#> i Method: Manhattan\n#> > Line by line\n#>  [1]  -57.28537  -58.97985 -102.26048 -119.55311  -59.76706 -117.55850\n#>  [7]  -57.28537 -193.79964 -102.26048 -119.55311  -59.76706 -117.55850\n#> > Overall mean\n#> [1] -97.13571\n#> i Method: Maximum\n#> > Line by line\n#>  [1]   0.60554241   0.60396075   0.41795957   0.01856209   0.39220500\n#>  [6]   0.28932291   0.60554241 -14.95654231   0.41795957   0.01856209\n#> [11]   0.39220500   0.28932291\n#> > Overall mean\n#> [1] -0.9087831\n#> i Method: Minkowski\n#> > Line by line\n#>  [1]  -1.662187  -1.729814  -3.807963  -4.603019  -1.810249  -4.458696\n#>  [7]  -1.662187 -19.380367  -3.807963  -4.603019  -1.810249  -4.458696\n#> > Overall mean\n#> [1] -4.482867\n#> i Method: Pearson\n#> > Line by line\n#>  [1] 0.9901437 0.9898982 0.9687513 0.9575260 0.9882873 0.9598702 0.9901437\n#>  [8] 0.1601500 0.9687513 0.9575260 0.9882873 0.9598702\n#> > Overall mean\n#> [1] 0.9066005\n```\n:::\n\n\n\n#### Text representation\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# The maximum value for the Jaccard bag similarity is 0.5.\n\ntext_representation(mctq_pt_text_textreuse, data_text_textreuse)\n#> i Method: Jaccard similarity\n#> [1] 0.1052632\n#> i Method: Jaccard bag similarity\n#> [1] 0.09815951\n```\n:::\n",
    "supporting": [
      "appendice-ch-2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}